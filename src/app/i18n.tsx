import { createContext, useContext, useState, useCallback, ReactNode } from 'react';

export type Lang = 'pt' | 'en';

const translations: Record<Lang, Record<string, string>> = {
  pt: {
    // Header
    'app.name': 'ImovelTop',
    'app.tagline': 'Encontre a casa dos seus sonhos',
    'header.login': 'Entrar',
    'header.logout': 'Sair',
    'header.myAccount': 'Minha Conta',
    'header.myProperties': 'Meus Imóveis',
    'header.addProperty': 'Adicionar Imóvel',
    'header.adminPanel': 'Painel Admin',
    'header.hello': 'Olá',
    // Filters
    'filters.title': 'Filtros de Pesquisa',
    'filters.clear': 'Limpar',
    'filters.type': 'Tipo',
    'filters.all': 'Todos',
    'filters.sale': 'Venda',
    'filters.rent': 'Arrendamento',
    'filters.city': 'Cidade',
    'filters.maxPrice': 'Preço Máximo (MT)',
    'filters.minPrice': 'Preço Mínimo (MT)',
    'filters.typology': 'Tipologia',
    'filters.allTypologies': 'Todas',
    'filters.search': 'Pesquisar...',
    'filters.minArea': 'Área Mín (m²)',
    'filters.maxArea': 'Área Máx (m²)',
    'filters.rooms': 'Quartos',
    'filters.anyRooms': 'Qualquer',
    'filters.features': 'Características',
    'filters.garage': 'Garagem',
    'filters.pool': 'Piscina',
    'filters.garden': 'Jardim',
    // Properties
    'property.found': 'Imóvel Encontrado',
    'property.foundPlural': 'Imóveis Encontrados',
    'property.viewDetails': 'Ver Detalhes',
    'property.scheduleVisit': 'Agendar Visita',
    'property.description': 'Descrição',
    'property.features': 'Características',
    'property.yearBuilt': 'Ano de Construção',
    'property.published': 'Publicado',
    'property.rooms': 'Quartos',
    'property.bathrooms': 'Casas de Banho',
    'property.area': 'Área',
    'property.typology': 'Tipologia',
    'property.compare': 'Comparar',
    'property.share': 'Partilhar',
    'property.favorite': 'Favoritar',
    'property.unfavorite': 'Remover favorito',
    // Visits
    'visit.schedule': 'Agendar Visita',
    'visit.chooseDate': 'Escolha a data',
    'visit.chooseTime': 'Escolha o horário',
    'visit.confirm': 'Confirmar Agendamento',
    'visit.cancel': 'Cancelar',
    'visit.sending': 'Enviando...',
    'visit.success': 'Visita agendada com sucesso!',
    'visit.fail': 'Falha ao agendar visita',
    'visit.conflict': 'Horário já ocupado. Escolha outro.',
    'visit.pending': 'Pendente',
    'visit.approved': 'Aprovado',
    'visit.rejected': 'Rejeitado',
    'visit.concluded': 'Concluído',
    // Client
    'client.welcome': 'Bem‑vindo',
    'client.explore': 'Explore imóveis, gerencie agendamentos e atualize o seu perfil.',
    'client.home': 'Início',
    'client.mySchedules': 'Meus Agendamentos',
    'client.editProfile': 'Editar Perfil',
    'client.favorites': 'Favoritos',
    'client.chat': 'Mensagens',
    'client.upcomingVisits': 'Próximas Visitas',
    'client.recommendedProperties': 'Imóveis Recomendados',
    'client.visitHistory': 'Histórico',
    'client.noSchedules': 'Nenhum agendamento encontrado',
    'client.noSchedulesDesc': 'Explore imóveis e agende visitas para ver aqui.',
    // Vendor
    'vendor.panel': 'Painel do Vendedor',
    'vendor.manageAds': 'Gerencie seus anúncios e adicione novos imóveis.',
    'vendor.noProperties': 'Nenhum imóvel',
    'vendor.noPropertiesDesc': 'Você ainda não tem imóveis anunciados.',
    'vendor.visitRequests': 'Pedidos de Visita',
    'vendor.stats': 'Estatísticas',
    // Admin
    'admin.panel': 'Painel de Administração',
    'admin.totalProperties': 'Total de Imóveis',
    'admin.forSale': 'Para Venda',
    'admin.forRent': 'Para Arrendamento',
    'admin.manageProperties': 'Gestão de Imóveis',
    'admin.visitRequests': 'Pedidos de Visita',
    'admin.users': 'Utilizadores',
    'admin.stats': 'Estatísticas',
    'admin.report': 'Relatório Mensal',
    // Notifications
    'notifications.title': 'Notificações',
    'notifications.markAllRead': 'Marcar tudo como lido',
    'notifications.noNotifications': 'Sem notificações',
    // Chat
    'chat.title': 'Mensagens',
    'chat.sendMessage': 'Enviar mensagem...',
    'chat.send': 'Enviar',
    'chat.noMessages': 'Nenhuma mensagem',
    'chat.startChat': 'Contactar',
    // Reviews
    'reviews.title': 'Avaliações',
    'reviews.write': 'Escrever Avaliação',
    'reviews.submit': 'Enviar Avaliação',
    'reviews.placeholder': 'Partilhe a sua opinião...',
    'reviews.noReviews': 'Ainda sem avaliações',
    // Compare
    'compare.title': 'Comparar Imóveis',
    'compare.add': 'Adicionar à comparação',
    'compare.remove': 'Remover da comparação',
    'compare.clear': 'Limpar comparação',
    // Share
    'share.copyLink': 'Copiar link',
    'share.whatsapp': 'WhatsApp',
    'share.copied': 'Link copiado!',
    // Dark mode
    'theme.light': 'Claro',
    'theme.dark': 'Escuro',
    'theme.system': 'Sistema',
    // Password reset
    'reset.title': 'Recuperar Senha',
    'reset.email': 'Email',
    'reset.send': 'Enviar',
    'reset.newPassword': 'Nova Senha',
    'reset.confirm': 'Confirmar',
    'reset.success': 'Senha redefinida com sucesso',
    'reset.tokenSent': 'Instruções enviadas para o seu email',
    // General
    'general.save': 'Salvar',
    'general.cancel': 'Cancelar',
    'general.delete': 'Eliminar',
    'general.edit': 'Editar',
    'general.back': 'Voltar',
    'general.loading': 'Carregando...',
    'general.noResults': 'Nenhum resultado encontrado',
    'general.approve': 'Aprovar',
    'general.reject': 'Rejeitar',
    'general.refresh': 'Atualizar',
    'general.name': 'Nome',
    'general.email': 'Email',
    'general.phone': 'Telefone',
    'general.password': 'Senha',
    'general.price': 'Preço',
    'general.location': 'Localização',
    'general.perMonth': '/mês',
  },
  en: {
    'app.name': 'ImovelTop',
    'app.tagline': 'Find your dream home',
    'header.login': 'Login',
    'header.logout': 'Logout',
    'header.myAccount': 'My Account',
    'header.myProperties': 'My Properties',
    'header.addProperty': 'Add Property',
    'header.adminPanel': 'Admin Panel',
    'header.hello': 'Hello',
    'filters.title': 'Search Filters',
    'filters.clear': 'Clear',
    'filters.type': 'Type',
    'filters.all': 'All',
    'filters.sale': 'Sale',
    'filters.rent': 'Rent',
    'filters.city': 'City',
    'filters.maxPrice': 'Max Price (MT)',
    'filters.minPrice': 'Min Price (MT)',
    'filters.typology': 'Typology',
    'filters.allTypologies': 'All',
    'filters.search': 'Search...',
    'filters.minArea': 'Min Area (m²)',
    'filters.maxArea': 'Max Area (m²)',
    'filters.rooms': 'Rooms',
    'filters.anyRooms': 'Any',
    'filters.features': 'Features',
    'filters.garage': 'Garage',
    'filters.pool': 'Pool',
    'filters.garden': 'Garden',
    'property.found': 'Property Found',
    'property.foundPlural': 'Properties Found',
    'property.viewDetails': 'View Details',
    'property.scheduleVisit': 'Schedule Visit',
    'property.description': 'Description',
    'property.features': 'Features',
    'property.yearBuilt': 'Year Built',
    'property.published': 'Published',
    'property.rooms': 'Bedrooms',
    'property.bathrooms': 'Bathrooms',
    'property.area': 'Area',
    'property.typology': 'Typology',
    'property.compare': 'Compare',
    'property.share': 'Share',
    'property.favorite': 'Favorite',
    'property.unfavorite': 'Unfavorite',
    'visit.schedule': 'Schedule Visit',
    'visit.chooseDate': 'Choose date',
    'visit.chooseTime': 'Choose time',
    'visit.confirm': 'Confirm Booking',
    'visit.cancel': 'Cancel',
    'visit.sending': 'Sending...',
    'visit.success': 'Visit scheduled successfully!',
    'visit.fail': 'Failed to schedule visit',
    'visit.conflict': 'Time slot taken. Choose another.',
    'visit.pending': 'Pending',
    'visit.approved': 'Approved',
    'visit.rejected': 'Rejected',
    'visit.concluded': 'Concluded',
    'client.welcome': 'Welcome',
    'client.explore': 'Explore properties, manage bookings and update your profile.',
    'client.home': 'Home',
    'client.mySchedules': 'My Bookings',
    'client.editProfile': 'Edit Profile',
    'client.favorites': 'Favorites',
    'client.chat': 'Messages',
    'client.upcomingVisits': 'Upcoming Visits',
    'client.recommendedProperties': 'Recommended Properties',
    'client.visitHistory': 'History',
    'client.noSchedules': 'No bookings found',
    'client.noSchedulesDesc': 'Explore properties and schedule visits.',
    'vendor.panel': 'Vendor Panel',
    'vendor.manageAds': 'Manage your listings and add new properties.',
    'vendor.noProperties': 'No properties',
    'vendor.noPropertiesDesc': 'You have no listed properties yet.',
    'vendor.visitRequests': 'Visit Requests',
    'vendor.stats': 'Statistics',
    'admin.panel': 'Admin Panel',
    'admin.totalProperties': 'Total Properties',
    'admin.forSale': 'For Sale',
    'admin.forRent': 'For Rent',
    'admin.manageProperties': 'Manage Properties',
    'admin.visitRequests': 'Visit Requests',
    'admin.users': 'Users',
    'admin.stats': 'Statistics',
    'admin.report': 'Monthly Report',
    'notifications.title': 'Notifications',
    'notifications.markAllRead': 'Mark all as read',
    'notifications.noNotifications': 'No notifications',
    'chat.title': 'Messages',
    'chat.sendMessage': 'Send a message...',
    'chat.send': 'Send',
    'chat.noMessages': 'No messages',
    'chat.startChat': 'Contact',
    'reviews.title': 'Reviews',
    'reviews.write': 'Write Review',
    'reviews.submit': 'Submit Review',
    'reviews.placeholder': 'Share your opinion...',
    'reviews.noReviews': 'No reviews yet',
    'compare.title': 'Compare Properties',
    'compare.add': 'Add to compare',
    'compare.remove': 'Remove from compare',
    'compare.clear': 'Clear comparison',
    'share.copyLink': 'Copy link',
    'share.whatsapp': 'WhatsApp',
    'share.copied': 'Link copied!',
    'theme.light': 'Light',
    'theme.dark': 'Dark',
    'theme.system': 'System',
    'reset.title': 'Reset Password',
    'reset.email': 'Email',
    'reset.send': 'Send',
    'reset.newPassword': 'New Password',
    'reset.confirm': 'Confirm',
    'reset.success': 'Password reset successfully',
    'reset.tokenSent': 'Instructions sent to your email',
    'general.save': 'Save',
    'general.cancel': 'Cancel',
    'general.delete': 'Delete',
    'general.edit': 'Edit',
    'general.back': 'Back',
    'general.loading': 'Loading...',
    'general.noResults': 'No results found',
    'general.approve': 'Approve',
    'general.reject': 'Reject',
    'general.refresh': 'Refresh',
    'general.name': 'Name',
    'general.email': 'Email',
    'general.phone': 'Phone',
    'general.password': 'Password',
    'general.price': 'Price',
    'general.location': 'Location',
    'general.perMonth': '/mo',
  },
};

interface I18nContextType {
  lang: Lang;
  setLang: (lang: Lang) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType>({
  lang: 'pt',
  setLang: () => {},
  t: (key) => key,
});

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLangState] = useState<Lang>(() => {
    const saved = localStorage.getItem('imobiliaria_lang');
    return (saved === 'en' ? 'en' : 'pt') as Lang;
  });

  const setLang = useCallback((l: Lang) => {
    setLangState(l);
    localStorage.setItem('imobiliaria_lang', l);
  }, []);

  const t = useCallback((key: string): string => {
    return translations[lang][key] || translations['pt'][key] || key;
  }, [lang]);

  return (
    <I18nContext.Provider value={{ lang, setLang, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}
